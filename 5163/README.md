# ğŸ” Certificate Authority Demo System (Root CA + Sub CA + Client)

This project simulates a full Public Key Infrastructure (PKI) system using Python, supporting:
- Root CA certificate creation and revocation management
- Sub CA certificate request via AES-encrypted CSR
- Client certificate request to Sub CA
- TLS mutual authentication between clients
- CRL-based certificate revocation and verification

## ğŸ“ Project Structure

```
.
â”œâ”€â”€ root_ca.py          # Root Certificate Authority logic
â”œâ”€â”€ sub_ca1.py          # First Subordinate CA
â”œâ”€â”€ sub_ca2.py          # Second Subordinate CA (optional for demo)
â”œâ”€â”€ client1.py          # Client 1
â”œâ”€â”€ client2.py          # Client 2
â”œâ”€â”€ cert_registry.json  # Shared certificate registry with revocation info
â”œâ”€â”€ *_cert.pem          # Generated certificate files
â”œâ”€â”€ *_private_key.pem   # Corresponding private keys
â”œâ”€â”€ *_crl.pem           # CRL files generated by CA
â”œâ”€â”€ *_request.enc       # Encrypted CSR request files
```

## âœ… Step-by-Step Testing Guide

### 1ï¸âƒ£ Start by Initializing Root CA

```bash
python root_ca.py
```

ğŸ“‹ At first launch, this script generates the Root CA certificate and key.  
Then you'll see a **menu interface**. Choose:

- `1` â€” to view issued certificates (empty at first)
- `3` â€” to wait for and approve incoming CSR requests from Sub CAs

### 2ï¸âƒ£ Apply for Certificate from Root CA (as Sub CA)

```bash
python sub_ca1.py
```

Choose:
- `1` â€” Apply to Root CA via encrypted CSR  
  ğŸ” An encrypted request file `sub_ca1_request.enc` is created.

Now return to `root_ca.py` and choose:
- `3` â€” Approve and sign Sub CA request

The signed `sub_ca1_cert.pem` will be generated. Now `sub_ca1` is a valid issuer.

### 3ï¸âƒ£ Issue Certificate from Sub CA to Client

```bash
python client1.py
```

Choose:
- `1` â€” Apply for certificate from Sub CA (`sub1`)

An encrypted request file `client1_request.enc` is created.

Now go back to `sub_ca1.py` and choose:
- `2` â€” Approve client request and issue certificate  
  `client1_cert.pem` is created and added to registry.

### 4ï¸âƒ£ Test TLS Mutual Authentication Between Clients

You will need **two terminals**:

**Terminal A:**

```bash
python client1.py
```
Choose:
- `2` â€” Listen mode on port `8443`

**Terminal B:**

```bash
python client2.py
```
Choose:
- `1` â€” Apply for certificate from `sub1` and get approved by Sub CA
- `3` â€” Connect to `127.0.0.1`, port `8443`

Youâ€™ll see the TLS connection succeed, and can send a message.

### 5ï¸âƒ£ Test Certificate Revocation (by Sub CA)

In `sub_ca1.py`, choose:
- `3` â€” Revoke issued certificate (enter: `client1`)

CRL `sub_ca1_crl.pem` is regenerated.

Then try connecting to `client1.py` again.  
ğŸ’£ TLS handshake will fail due to revoked certificate.

### 6ï¸âƒ£ Test Sub CA Revocation (by Root CA)

In `root_ca.py`, choose:
- `2` â€” Revoke certificate (enter: `sub_ca1`)

All certificates issued by Sub CA (e.g., `client1`) will also be **automatically marked revoked** in `cert_registry.json`.

Try using `client1.py` again â€” you'll see it refuses to connect.

## ğŸ§ª Tested Features

| Feature | Tested |
|--------|--------|
| Root CA key & cert generation | âœ… |
| Sub CA encrypted CSR & signing | âœ… |
| Sub CA issuing client certificates | âœ… |
| AES encryption of CSR | âœ… |
| Mutual TLS between clients | âœ… |
| CRL-based revocation detection | âœ… |
| Sub CA revokes client certs | âœ… |
| Root CA revokes Sub CA + cascade | âœ… |

## ğŸ›  Requirements

- Python 3.9+
- `cryptography` module

Install via:

```bash
pip install cryptography
```

## ğŸ“Œ Notes

- The shared `aes_key` is hardcoded for simplicity.
- All files are stored in the working directory.
- You can create more `clientX.py` or `sub_caX.py` files as needed to scale the system.

## ğŸ‘¤ Author

Hongxiang Shao â€“ 33995176 â€“ FIT5163 Assignment
